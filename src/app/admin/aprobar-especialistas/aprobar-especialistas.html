<div class="admin-container">
  <button class="btn-back" (click)="goBack()" title="Volver al dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Volver al Dashboard
  </button>

  <h2>Panel de Gestión de Especialistas</h2>

  <div class="admin-create" style="margin-bottom:20px; padding:15px; border:1px solid #e6e6e6; border-radius:6px; background:#fff;">
    <h3 style="margin-top:0;">Crear nuevo usuario (Admin)</h3>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <select [(ngModel)]="newUser.role" style="padding:8px; min-width:170px;">
        <option value="patient">Paciente</option>
        <option value="specialist">Especialista</option>
        <option value="admin">Administrador</option>
      </select>

      <input type="text" placeholder="Nombre" [(ngModel)]="newUser.name" style="padding:8px; min-width:200px;" />
      <input type="text" placeholder="Apellido" [(ngModel)]="newUser.last_name" style="padding:8px; min-width:200px;" />
      <input type="number" placeholder="Edad" [(ngModel)]="newUser.age" style="padding:8px; width:100px;" />
      <input type="text" placeholder="DNI" [(ngModel)]="newUser.dni" style="padding:8px; min-width:150px;" />
      <input type="email" placeholder="Email" [(ngModel)]="newUser.email" style="padding:8px; min-width:220px;" />
      <input type="password" placeholder="Password" [(ngModel)]="newUser.password" style="padding:8px; min-width:180px;" />

      <select *ngIf="newUser.role === 'specialist'" [(ngModel)]="newUser.specialty" style="padding:8px; min-width:200px;">
        <option value="">-- Seleccionar especialidad --</option>
        <option *ngFor="let s of specialities" [value]="s.name">{{ s.name }}</option>
      </select>

      <input *ngIf="newUser.role === 'patient'" type="text" placeholder="Obra Social" [(ngModel)]="newUser.health_insurance" style="padding:8px; min-width:200px;" />

      <!-- Imágenes de perfil -->
      <div style="display: flex; gap: 10px; align-items: center; width: 100%;">
        <div style="flex: 1;">
          <label style="display: block; font-size: 12px; margin-bottom: 4px; font-weight: 600;">
            {{ newUser.role === 'patient' ? 'Imagen 1' : 'Imagen de perfil' }}
          </label>
          <input type="file" accept="image/*" (change)="onAdminFileSelected($event, 1)" 
                 style="padding:4px; width:100%; font-size:12px;" />
          <span *ngIf="newUserImage1" style="color: green; font-size: 11px;">✓ {{ newUserImage1.name }}</span>
        </div>

        <div *ngIf="newUser.role === 'patient'" style="flex: 1;">
          <label style="display: block; font-size: 12px; margin-bottom: 4px; font-weight: 600;">
            Imagen 2
          </label>
          <input type="file" accept="image/*" (change)="onAdminFileSelected($event, 2)" 
                 style="padding:4px; width:100%; font-size:12px;" />
          <span *ngIf="newUserImage2" style="color: green; font-size: 11px;">✓ {{ newUserImage2.name }}</span>
        </div>
      </div>

      <!-- Captcha oculto para admin -->

      <div style="align-self:center;">
        <button (click)="createUser()" style="background:#007bff;color:#fff;padding:8px 14px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;">Crear usuario</button>
      </div>
    </div>
  </div>

  <div class="filters-section" style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 5px;">
    <input 
      type="text"
      placeholder="Buscar por nombre..."
      [(ngModel)]="searchTerm"
      (input)="applyFilters()"
      style="padding: 8px; width: 250px; margin-right: 15px;"
    >

    <label style="margin-left: 10px;">
      <input 
        type="checkbox" 
        [(ngModel)]="filtroPendientes" 
        (change)="applyFilters()"
      >
      <span style="margin-left: 5px;">Mostrar solo pendientes</span>
    </label>
  </div>

  <p *ngIf="loading" style="text-align: center; color: #666;">Cargando especialistas...</p>

  <div *ngIf="!loading && filteredSpecialists.length > 0" class="specialists-list">
    <div *ngFor="let esp of filteredSpecialists" class="specialist-card" style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #fafafa;">

      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
        <div>
          <h3 style="margin: 0 0 5px 0;">{{ esp.name }} {{ esp.last_name }}</h3>
          <p style="margin: 5px 0; color: #666; font-size: 14px;">
            <strong>Email:</strong> {{ esp.email }}
          </p>
          <p style="margin: 5px 0; color: #666; font-size: 14px;">
            <strong>Especialidad:</strong> {{ esp.especialidad }}
          </p>
          <p style="margin: 5px 0; color: #666; font-size: 14px;">
            <strong>DNI:</strong> {{ esp.dni || 'No especificado' }}
          </p>
        </div>

        <div style="text-align: right;">
          <p style="margin: 0; font-size: 14px;">
            <strong>Estado:</strong>
          </p>
          <span 
            [style.color]="esp.is_approved ? '#28a745' : '#ffc107'"
            [style.font-weight]="'bold'"
            style="font-size: 14px;"
          >
            {{ esp.is_approved ? '✅ Aprobado' : '⏳ Pendiente' }}
          </span>
        </div>
      </div>

        <div style="display:flex; gap:8px;">
          <button 
            (click)="toggleApproval(esp)"
            [style.backgroundColor]="esp.is_approved ? '#dc3545' : '#28a745'"
            [style.color]="'white'"
            style="padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; font-weight: bold;"
          >
            {{ esp.is_approved ? 'Desaprobar' : 'Aprobar' }}
          </button>

        
        </div>

    </div>
  </div>

  <p *ngIf="!loading && filteredSpecialists.length === 0" style="text-align: center; color: #999; padding: 20px;">
    No hay especialistas que coincidan con el filtro.
  </p>
</div>

<style>
  .admin-container {
    padding: 20px;
    max-width: 1000px;
    margin: 0 auto;
    position: relative;
  }

  .btn-back {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 8px 16px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 600;
    color: #495057;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 20px;
  }

  .btn-back svg {
    transition: transform 0.3s ease;
  }

  .btn-back:hover {
    background: #e9ecef;
    border-color: #adb5bd;
    transform: translateX(-3px);
  }

  .btn-back:hover svg {
    transform: translateX(-3px);
  }

  h2 {
    margin-bottom: 20px;
    color: #333;
  }
</style>
