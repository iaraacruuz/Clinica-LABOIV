<div class="dashboard-container">
  <nav class="navbar">
    <div class="navbar-brand">
      <img src="clinic-icon.svg" alt="ClÃ­nica" class="navbar-logo" />
      <div class="brand-text">
        <h1>ClÃ­nica Online</h1>
        <span class="role-badge">{{ getRoleLabel() }}</span>
      </div>
    </div>
    <div class="navbar-actions">
      <span *ngIf="currentUser" class="user-info">
        ğŸ‘¤ {{ currentUser.name }} {{ currentUser.last_name }}
      </span>
      <button (click)="requestLogout()" class="btn btn-logout">Cerrar sesiÃ³n</button>
    </div>
  </nav>

  <div class="dashboard-main">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
      <button 
        (click)="setActiveSection('home')"
        [class.active]="activeSection === 'home'"
        class="nav-button"
      >
        ğŸ  Inicio
      </button>

      <!-- Admin menu -->
      <ng-container *ngIf="currentUser?.role === 'admin'">
        <button 
          (click)="setActiveSection('especialistas')"
          [class.active]="activeSection === 'especialistas'"
          class="nav-button"
        >
          ğŸ‘¨â€âš•ï¸ Gestionar Especialistas
        </button>
        <button 
          (click)="setActiveSection('usuarios')"
          [class.active]="activeSection === 'usuarios'"
          class="nav-button"
        >
          ğŸ‘¥ Todos los Usuarios
        </button>
        <button 
          (click)="setActiveSection('turnos-admin')"
          [class.active]="activeSection === 'turnos-admin'"
          class="nav-button"
        >
          ğŸ“… Turnos (Admin)
        </button>
        <button 
          (click)="setActiveSection('solicitar-turno')"
          [class.active]="activeSection === 'solicitar-turno'"
          class="nav-button"
        >
          â• Solicitar Turno
        </button>
        <button 
          (click)="setActiveSection('estadisticas')"
          [class.active]="activeSection === 'estadisticas'"
          class="nav-button"
        >
          ğŸ“ˆ EstadÃ­sticas
        </button>
      </ng-container>

      <!-- Specialist menu -->
      <ng-container *ngIf="currentUser?.role === 'specialist'">
        <button 
          (click)="setActiveSection('turnos')"
          [class.active]="activeSection === 'turnos'"
          class="nav-button"
        >
          ğŸ“… Mis Turnos
        </button>
        <button 
          (click)="setActiveSection('pacientes')"
          [class.active]="activeSection === 'pacientes'"
          class="nav-button"
        >
          ğŸ‘¥ Mis Pacientes
        </button>
        <button 
          (click)="setActiveSection('perfil')"
          [class.active]="activeSection === 'perfil'"
          class="nav-button"
        >
          âš™ï¸ Mi Perfil
        </button>
      </ng-container>

      <!-- Patient menu -->
      <ng-container *ngIf="currentUser?.role === 'patient'">
        <button 
          (click)="setActiveSection('turnos')"
          [class.active]="activeSection === 'turnos'"
          class="nav-button"
        >
          ğŸ“… Mis Turnos
        </button>
        <button 
          (click)="setActiveSection('solicitar-turno')"
          [class.active]="activeSection === 'solicitar-turno'"
          class="nav-button"
        >
          â• Solicitar Turno
        </button>
        <button 
          (click)="setActiveSection('perfil')"
          [class.active]="activeSection === 'perfil'"
          class="nav-button"
        >
          âš™ï¸ Mi Perfil
        </button>
      </ng-container>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- HOME SECTION -->
      <div *ngIf="activeSection === 'home'" class="section" @slideInUp>
        <div class="welcome-card">
          <h2>Â¡Bienvenido/a, {{ currentUser?.name }}! ğŸ‘‹</h2>
          
          <div *ngIf="currentUser?.role === 'admin'" class="welcome-content">
            <p class="subtitle">Panel de AdministraciÃ³n</p>
            <p>Desde aquÃ­ podÃ©s gestionar especialistas, pacientes y ver estadÃ­sticas del sistema.</p>

            <div class="stats-grid" *ngIf="!loading">
              <div class="stat-card" @fadeIn>
                <div class="stat-icon">ğŸ‘¨â€âš•ï¸</div>
                <h3>Especialistas Totales</h3>
                <p class="stat-number">{{ stats.totalSpecialists }}</p>
              </div>
              <div class="stat-card warning" @fadeIn>
                <div class="stat-icon">â³</div>
                <h3>Pendientes de AprobaciÃ³n</h3>
                <p class="stat-number">{{ stats.pendingSpecialists }}</p>
              </div>
              <div class="stat-card success" @fadeIn>
                <div class="stat-icon">âœ…</div>
                <h3>Especialistas Aprobados</h3>
                <p class="stat-number">{{ stats.approvedSpecialists }}</p>
              </div>
              <div class="stat-card info" @fadeIn>
                <div class="stat-icon">ğŸ‘¥</div>
                <h3>Pacientes Registrados</h3>
                <p class="stat-number">{{ stats.totalPatients }}</p>
              </div>
            </div>

            <p *ngIf="loading" class="loading-message">Cargando estadÃ­sticas...</p>

            <div *ngIf="!loading" class="quick-actions">
              <div class="action-card" (click)="setActiveSection('especialistas')">
                <div class="action-icon">ğŸ‘¨â€âš•ï¸</div>
                <h3>Gestionar Especialistas</h3>
                <p>Aprobar y crear especialistas</p>
              </div>
              <div class="action-card" (click)="setActiveSection('turnos-admin')">
                <div class="action-icon">ğŸ“…</div>
                <h3>Ver Turnos</h3>
                <p>Administrar todos los turnos</p>
              </div>
              <div class="action-card" (click)="setActiveSection('solicitar-turno')">
                <div class="action-icon">â•</div>
                <h3>Solicitar Turno</h3>
                <p>Crear turnos para pacientes</p>
              </div>
            </div>
          </div>

          <div *ngIf="currentUser?.role === 'specialist'" class="welcome-content">
            <p class="subtitle">Portal del Especialista</p>
            <p>GestionÃ¡ tus turnos, horarios y consultas de pacientes desde esta plataforma.</p>
            
            <div class="quick-actions">
              <div class="action-card" (click)="setActiveSection('turnos')">
                <div class="action-icon">ğŸ“…</div>
                <h3>Ver Turnos</h3>
                <p>ConsultÃ¡ y gestionÃ¡ tus turnos programados</p>
              </div>
              <div class="action-card" (click)="setActiveSection('perfil')">
                <div class="action-icon">âš™ï¸</div>
                <h3>Configurar Perfil</h3>
                <p>ActualizÃ¡ tu informaciÃ³n y disponibilidad</p>
              </div>
            </div>
          </div>

          <div *ngIf="currentUser?.role === 'patient'" class="welcome-content">
            <p class="subtitle">Portal del Paciente</p>
            <p>GestionÃ¡ tus turnos con especialistas y accedÃ© a tu historial mÃ©dico.</p>
            
            <div class="quick-actions">
              <div class="action-card" (click)="setActiveSection('turnos')">
                <div class="action-icon">ğŸ“…</div>
                <h3>Mis Turnos</h3>
                <p>ConsultÃ¡ y gestionÃ¡ tus turnos programados</p>
              </div>
              <div class="action-card" (click)="setActiveSection('solicitar-turno')">
                <div class="action-icon">â•</div>
                <h3>Solicitar Turno</h3>
                <p>ReservÃ¡ un turno con un especialista</p>
              </div>
              <div class="action-card" (click)="setActiveSection('perfil')">
                <div class="action-icon">âš™ï¸</div>
                <h3>Mi Perfil</h3>
                <p>VisualizÃ¡ y actualizÃ¡ tus datos personales</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ESPECIALISTAS SECTION (Admin only) -->
      <div *ngIf="activeSection === 'especialistas' && currentUser?.role === 'admin'" class="section">
        <app-aprobar-especialistas></app-aprobar-especialistas>
      </div>

      <!-- ESTADISTICAS SECTION (Admin only) -->
      <div *ngIf="activeSection === 'estadisticas' && currentUser?.role === 'admin'" class="section">
        <app-estadisticas></app-estadisticas>
      </div>

      <!-- USUARIOS SECTION (Admin only) -->
      <div *ngIf="activeSection === 'usuarios' && currentUser?.role === 'admin'" class="section" @slideInUp>
        <app-usuarios-admin></app-usuarios-admin>
      </div>

      <!-- TURNOS ADMIN SECTION (Admin only) -->
      <div *ngIf="activeSection === 'turnos-admin' && currentUser?.role === 'admin'" class="section" @slideInUp>
        <app-turnos-admin></app-turnos-admin>
      </div>

      <!-- SOLICITAR TURNO SECTION -->
      <div *ngIf="activeSection === 'solicitar-turno'" class="section" @slideInUp>
        <app-solicitar-turno></app-solicitar-turno>
      </div>

      <!-- TURNOS SECTION -->
      <div *ngIf="activeSection === 'turnos'" class="section" @slideInUp>
        <!-- Para pacientes: mostrar Mis Turnos -->
        <div *ngIf="currentUser?.role === 'patient'" class="full-width-section">
          <app-mis-turnos></app-mis-turnos>
        </div>
        
        <!-- Para especialistas: mostrar Mis Turnos Especialista -->
        <div *ngIf="currentUser?.role === 'specialist'" class="full-width-section">
          <app-mis-turnos-especialista></app-mis-turnos-especialista>
        </div>
      </div>

      <!-- PACIENTES SECTION (ESPECIALISTA) -->
      <div *ngIf="activeSection === 'pacientes'" class="section" @slideInUp>
        <app-pacientes-especialista></app-pacientes-especialista>
      </div>

      <!-- PERFIL SECTION -->
      <div *ngIf="activeSection === 'perfil'" class="section" @slideInUp>
        <app-mi-perfil></app-mi-perfil>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n de cierre de sesiÃ³n -->
<app-confirmation-modal
  [isVisible]="showLogoutConfirmation"
  [title]="'Â¿Cerrar sesiÃ³n?'"
  [message]="'Â¿EstÃ¡s seguro que deseas cerrar sesiÃ³n?'"
  [confirmText]="'SÃ­, cerrar sesiÃ³n'"
  [cancelText]="'Cancelar'"
  (onConfirm)="confirmLogout()"
  (onCancel)="cancelLogout()">
</app-confirmation-modal>
