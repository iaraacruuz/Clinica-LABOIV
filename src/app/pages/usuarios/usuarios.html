<div class="max-w-xl mx-auto py-12 px-4 sm:px-6 lg:px-8 fade-in">
  <div class="bg-white shadow-2xl rounded-xl p-8 border border-gray-100 transform hover:shadow-3xl transition duration-300">
    <h2 class="text-4xl font-extrabold text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 mb-8">
      Registro de Nuevo Usuario
    </h2>

    <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()" class="space-y-6" *ngIf="usuarioForm">
      <div class="text-center">
        <img [src]="fotoPerfilUrl" alt="Foto de Perfil"
             class="w-32 h-32 rounded-full mx-auto object-cover border-4 border-indigo-400 shadow-lg mb-3 ring-2 ring-indigo-200">
        <label class="cursor-pointer inline-flex items-center bg-indigo-50 text-indigo-700 py-2 px-6 rounded-full font-semibold shadow-md hover:bg-indigo-100 transition duration-200">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
               xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
          </svg>
          Subir Imagen
          <input type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden">
        </label>
        <div *ngIf="f['imagenPerfil'].invalid && (f['imagenPerfil'].dirty || f['imagenPerfil'].touched)"
             class="mt-2 text-sm text-red-600 font-medium">
          <div *ngIf="f['imagenPerfil'].errors?.['required']">
            La imagen de perfil es obligatoria.
          </div>
        </div>
      </div>

      <div>
        <label for="perfil" class="block text-sm font-medium text-gray-700">Perfil del Usuario</label>
        <select id="perfil" formControlName="perfil"
                class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
          <option value="" disabled>Seleccione un perfil</option>
          <option *ngFor="let perfil of perfilesDisponibles" [value]="perfil" class="capitalize">
            {{ perfil }}
          </option>
        </select>
        <div *ngIf="f['perfil'].invalid && (f['perfil'].dirty || f['perfil'].touched)"
             class="mt-1 text-sm text-red-600">
          <div *ngIf="f['perfil'].errors?.['required']">El perfil es obligatorio.</div>
        </div>
      </div>

      <div>
        <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
        <input id="nombre" type="text" formControlName="nombre" placeholder="Ingrese el nombre"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['nombre'].invalid && (f['nombre'].dirty || f['nombre'].touched)"
             class="mt-1 text-sm text-red-600">
          <div *ngIf="f['nombre'].errors?.['required']">El nombre es obligatorio.</div>
          <div *ngIf="f['nombre'].errors?.['minlength']">Mínimo 3 caracteres.</div>
        </div>
      </div>

      <div>
        <label for="apellido" class="block text-sm font-medium text-gray-700">Apellido</label>
        <input id="apellido" type="text" formControlName="apellido" placeholder="Ingrese el apellido"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['apellido'].invalid && (f['apellido'].dirty || f['apellido'].touched)"
             class="mt-1 text-sm text-red-600">
          <div *ngIf="f['apellido'].errors?.['required']">El apellido es obligatorio.</div>
        </div>
      </div>

      <div>
        <label for="edad" class="block text-sm font-medium text-gray-700">Edad</label>
        <input id="edad" type="number" formControlName="edad" placeholder="Edad entre 18 y 100"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['edad'].invalid && (f['edad'].dirty || f['edad'].touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="f['edad'].errors?.['required']">La edad es obligatoria.</div>
          <div *ngIf="f['edad'].errors?.['min'] || f['edad'].errors?.['max']">Debe ser una edad válida (18-100).</div>
        </div>
      </div>

      <div>
        <label for="dni" class="block text-sm font-medium text-gray-700">DNI</label>
        <input id="dni" type="text" formControlName="dni" placeholder="Documento Nacional de Identidad"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['dni'].invalid && (f['dni'].dirty || f['dni'].touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="f['dni'].errors?.['required']">El DNI es obligatorio.</div>
          <div *ngIf="f['dni'].errors?.['pattern']">Formato de DNI inválido.</div>
        </div>
      </div>

      <div>
        <label for="mail" class="block text-sm font-medium text-gray-700">Email</label>
        <input id="mail" type="email" formControlName="mail" placeholder="ejemplo@dominio.com"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['mail'].invalid && (f['mail'].dirty || f['mail'].touched)" class="mt-1 text-sm text-red-600">
          <div *ngIf="f['mail'].errors?.['required']">El email es obligatorio.</div>
          <div *ngIf="f['mail'].errors?.['email']">Debe ser un email válido.</div>
        </div>
      </div>

      <div>
        <label for="password" class="block text-sm font-medium text-gray-700">Contraseña</label>
        <input id="password" type="password" formControlName="password" placeholder="Mínimo 6 caracteres"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['password'].invalid && (f['password'].dirty || f['password'].touched)"
             class="mt-1 text-sm text-red-600">
          <div *ngIf="f['password'].errors?.['required']">La contraseña es obligatoria.</div>
          <div *ngIf="f['password'].errors?.['minlength']">Mínimo 6 caracteres.</div>
        </div>
      </div>

      <div *ngIf="f['perfil'].value === 'especialista'">
        <label for="especialidad" class="block text-sm font-medium text-gray-700">Especialidad</label>
        <input id="especialidad" type="text" formControlName="especialidad" placeholder="Ej: Pediatría, Cardiología"
               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
        <div *ngIf="f['especialidad'].invalid && (f['especialidad'].dirty || f['especialidad'].touched)"
             class="mt-1 text-sm text-red-600">
          <div *ngIf="f['especialidad'].errors?.['required']">La especialidad es obligatoria para el perfil Especialista.</div>
        </div>
      </div>

      <button type="submit" [disabled]="usuarioForm.invalid"
              class="w-full py-3 px-4 border border-transparent rounded-lg shadow-xl text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
        Crear Usuario
      </button>
    </form>
  </div>
</div>
